#!/usr/bin/env sh
set -e
. "../support/common.sh"

case $1 in
  "localhost")
    echo "localhost: not setting docker labels or insecure-registries or DNS resolving"
  ;;
  *)
    echo "{
      \"labels\": [\"$KONTENA_NODE_LABEL\"],
      \"insecure-registries\": [\"10.81.0.0/16\"]
    }" | sudo tee /etc/docker/daemon.json

    echo "nameserver 172.17.0.1" | sudo resolvconf -a lo
    sudo systemctl restart docker
  ;;
esac

docker-compose up -d agent
docker-compose logs -f agent
